var accessToken="8f330cbcfadd4ebbbcff549d6ebb7fe9",baseUrl="https://api.api.ai/v1/",$speechInput,recognition,messageRecording="\u8fa8\u8b58\u4e2d...",messageCouldntHear="\u86e4.\u4f60\u8aaa\u5565",messageInternalError="\u767c\u751f\u4f3a\u670d\u5668\u932f\u8aa4\u60f9",messageSorry="\u8aaa\u8aaa\u5225\u7684";$(document).ready(function(){$speechInput=$("#speech")});
function startRecognition(){recognition=new webkitSpeechRecognition;recognition.continuous=!1;recognition.interimResults=!1;recognition.onstart=function(a){respond(messageRecording)};recognition.onresult=function(a){recognition.onend=null;for(var b="",c=a.resultIndex;c<a.results.length;++c)b+=a.results[c][0].transcript;setInput(b);stopRecognition()};recognition.onend=function(){respond(messageCouldntHear);stopRecognition()};recognition.lang="cmn-Hant-TW";recognition.start()}
function stopRecognition(){recognition&&(recognition.stop(),recognition=null)}function switchRecognition(){recognition?stopRecognition():startRecognition()}function setInput(a){$speechInput.val(a);send()}
function send(){var a=$speechInput.val();$.ajax({type:"POST",url:baseUrl+"query",contentType:"application/json; charset=utf-8",dataType:"json",headers:{Authorization:"Bearer "+accessToken},data:JSON.stringify({query:a,lang:"zh-TW",sessionId:"21351"}),success:function(a){prepareResponse(a)},error:function(){respond(messageInternalError)}})}function prepareResponse(a){var b=JSON.stringify(a,void 0,2);respond(a.result.speech);debugRespond(b)}function debugRespond(a){$("#response").text(a)}
function respond(a){""==a&&(a=messageSorry);if(a!==messageRecording){var b=new SpeechSynthesisUtterance;b.voiceURI="native";b.text=a;b.lang="zh-TW";window.speechSynthesis.speak(b)}$("#spokenResponse").addClass("is-active").find(".spoken-response__text").html(a)};